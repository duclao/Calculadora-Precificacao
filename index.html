<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Calculadora de Markup ‚Äî Mobile (v5.1)</title>
<style>
  *, *::before, *::after { box-sizing: border-box; }
  :root{
    --bg1:#111827; --bg2:#0b1220; --card:#0f172a; --border:#1f2937;
    --text:#e5e7eb; --muted:#a1a1aa;
    --brand1:#6366f1; --brand2:#8b5cf6; --success:#22c55e; --danger:#ef4444;
    --radius:14px; --shadow:0 10px 24px rgba(0,0,0,.35);
  }
  html,body{ margin:0; background:linear-gradient(160deg,#1e293b,#0f172a); color:var(--text); font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, 'Helvetica Neue', Arial; }
  .container{ max-width:760px; margin:0 auto; padding:10px 12px 24px; }

  /* HERO */
  .hero{ background:linear-gradient(135deg,#3b82f6,#8b5cf6); border-radius:16px; box-shadow:var(--shadow); padding:14px 14px 12px; text-align:center; }
  .hero .title{ font-size:12px; opacity:.9; margin-bottom:2px; }
  .hero .price{ font-size:28px; font-weight:900; margin:0; line-height:1; }
  .hero .sub{ font-size:11px; opacity:.85; margin-top:4px; }
  .hero .alt{ margin-top:6px; font-size:14px; font-weight:700; }
  .hero .alt small{ font-weight:600; opacity:.9; }

  /* PANELS */
  .panel{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); margin-top:10px; }
  .panel-h{ padding:10px 12px; font-weight:800; font-size:17px; background:#0b1628; border-bottom:1px solid var(--border); }
  .panel-b{ padding:10px 12px; }
  .legend{ font-size:12px; color:var(--muted); margin-bottom:6px; }

  /* inputs */
  label{ font-size:13px; display:block; margin:10px 0 6px; }
  input[type="text"]{
    width:100%; max-width:100%; padding:12px 14px; font-size:16px;
    border-radius:12px; border:1px solid #334155; background:#0b1220; color:#e5e7eb; outline:none;
    -webkit-appearance: none; appearance:none;
    overflow: hidden; text-overflow: ellipsis;
  }
  .grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  @media (max-width:520px){ .grid{ grid-template-columns:1fr 1fr; } }
  @media (max-width:400px){ .grid{ grid-template-columns:1fr; } }
  .row-actions{ display:flex; gap:10px; align-items:center; margin-top:10px; flex-wrap:wrap; }
  button{ padding:12px 16px; border-radius:12px; border:none; color:white; font-weight:800; cursor:pointer; }
  .btn-primary{ background:linear-gradient(135deg,var(--brand1),var(--brand2)); flex:1; min-width:140px; }
  .btn-secondary{ background:#0b1220; color:#e5e7eb; border:1px solid #334155; }
  .switch{ display:flex; align-items:center; gap:10px; font-size:13px; color:var(--muted); margin-top:2px; }
  .switch input{ width:18px; height:18px; }

  /* IMPACTO DO DESCONTO (sempre vis√≠vel) */
  .impact .box{
    border:1px solid #1f2a44; border-radius:16px; padding:12px; margin:10px 0; background:#0b1628;
  }
  .impact .lbl{ font-weight:800; letter-spacing:.3px; font-size:12px; color:#cbd5e1; margin-bottom:6px; text-transform:uppercase; }
  .impact .valor{ font-size:34px; font-weight:900; margin:0; line-height:1; }
  .impact .valor.green{ color:var(--success); }
  .impact .subtxt{ font-size:12px; color:#a1a1aa; margin-top:4px; }
  .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace; }
  .neg{ color:var(--danger); font-weight:700; }

  footer{ text-align:center; font-size:12px; color:#94a3b8; margin:18px 0 8px; line-height:1.5; padding:0 8px; }
</style>

<script>
function $(id){ return document.getElementById(id); }
function fmt(v){
  try{ return isFinite(v) ? Number(v).toLocaleString('pt-BR',{style:'currency',currency:'BRL'}) : 'R$\u00A00,00'; }
  catch(e){ return 'R$ ' + (Math.round((+v||0)*100)/100).toFixed(2).replace('.',','); }
}
function toNum(s){
  s = String(s==null? '': s);
  s = s.replace(/\s+/g,'').replace(/[^0-9,\.\-]/g,'');
  const parts = s.split(/[.,]/);
  if(parts.length>1){
    const dec = parts.pop();
    s = parts.join('') + '.' + dec;
  }else{
    s = s.replace(',', '.');
  }
  const n = parseFloat(s);
  return isNaN(n)? 0 : n;
}
function val(p,pc){ return p*(pc/100); }

function calcular(){
  const custo = toNum($('custo').value);
  const despesas = toNum($('despesas').value);
  const lucro = toNum($('lucro').value);
  const impostos = toNum($('aliquota').value);
  const comissao = toNum($('comissao').value);
  const desconto = toNum($('desconto').value);
  const preservar = $('preservar').checked;

  const soma = despesas + lucro + impostos + comissao;
  if(soma >= 100){
    alert('A soma de despesas + impostos + lucro + comiss√£o n√£o pode ser ‚â• 100%.');
    return;
  }

  const mult = 100 / (100 - soma);
  const precoSemDescBase = custo * mult;
  let precoCalc, precoFinal;

  if(preservar){
    precoFinal = precoSemDescBase;
    const fator = 1 - (desconto/100);
    precoCalc = fator>0 ? (precoFinal / fator) : precoFinal;
  }else{
    precoCalc = precoSemDescBase;
    precoFinal = precoCalc * (1 - desconto/100);
  }

  // componentes
  const dCalc = val(precoCalc, despesas);
  const iCalc = val(precoCalc, impostos);
  const cCalc = val(precoCalc, comissao);
  const lucroSobreVendaSem = val(precoCalc, lucro);
  const lucroRealSem = precoCalc - custo - dCalc - iCalc - cCalc;

  // finais
  const dFinal = val(precoFinal, despesas);
  const iFinal = val(precoFinal, impostos);
  const cFinal = val(precoFinal, comissao);
  const lucroSobreVendaCom = val(precoFinal, lucro);
  const lucroRealCom = precoFinal - custo - dFinal - iFinal - cFinal;
  const reducao = Math.max(0, lucroRealSem - lucroRealCom);

  // HERO
  $('p-sug').textContent = fmt(precoCalc);
  const wrap = $('p-desc-wrap');
  if((desconto||0)>0){ wrap.style.display='block'; $('p-desc').textContent = fmt(precoFinal); } else { wrap.style.display='none'; }

  // IMPACTO (cards)
  $('preco-sem').textContent = fmt(precoCalc);
  $('preco-com').textContent = fmt(precoFinal);

  $('lucro-sv-sem').textContent = fmt(lucroSobreVendaSem);
  $('lucro-sv-com').textContent = fmt(lucroSobreVendaCom);

  $('lucro-real-sem').textContent = fmt(lucroRealSem);
  $('lucro-real-com').textContent = fmt(lucroRealCom);

  const red = $('lucro-reducao');
  red.textContent = fmt(reducao);
  red.classList.toggle('neg', reducao>0);
}

function limpar(){
  ['custo','despesas','lucro','aliquota','comissao','desconto'].forEach(id=>$(id).value='');
  $('preservar').checked = false; calcular();
}

document.addEventListener('DOMContentLoaded', ()=>{
  // eventos
  ['custo','despesas','lucro','aliquota','comissao','desconto'].forEach(id=>{
    $(id).addEventListener('input', calcular);
  });
  $('preservar').addEventListener('change', calcular);
  $('calc').addEventListener('click', calcular);
  $('clear').addEventListener('click', limpar);
  calcular();
});
</script>
</head>

<body>
  <div class="container">
    <!-- HERO -->
<h1 style="
  text-align:center;
  font-size:28px;
  font-weight:900;
  text-transform:uppercase;
  letter-spacing:1px;
  color:#ffffff;
  margin-top:10px;
  margin-bottom:6px;
">
  Pre√ßo Certo
</h1>
<p style="
  text-align:center;
  font-size:13px;
  color:#94a3b8;
  margin-top:0;
  margin-bottom:10px;
">
  Calculadora de Precifica√ß√£o Inteligente
</p>
    <div class="hero">
      <div class="title">Pre√ßo Sugerido</div>
      <div id="p-sug" class="price">R$ 0,00</div>
      <div id="p-desc-wrap" class="alt" style="display:none;"><small>Pre√ßo c/ desconto:</small> <span id="p-desc">R$ 0,00</span></div>
      <div class="sub">Baseado nos par√¢metros abaixo</div>
    </div>

    <!-- FORM -->
    <div class="panel">
      <div class="panel-h">C√°lculo do Markup</div>
      <div class="panel-b">
        <div class="legend">Percentuais s√£o aplicados sobre o pre√ßo de venda.</div>
        <div class="grid">
          <div>
            <label for="custo">Custo (R$)</label>
            <input id="custo" type="text" inputmode="decimal" autocomplete="off" value=""/>
          </div>
          <div>
            <label for="despesas">Despesas (%)</label>
            <input id="despesas" type="text" inputmode="decimal" autocomplete="off" value=""/>
          </div>
          <div>
            <label for="lucro">Lucro (%)</label>
            <input id="lucro" type="text" inputmode="decimal" autocomplete="off" value=""/>
          </div>
          <div>
            <label for="aliquota">Impostos (%)</label>
            <input id="aliquota" type="text" inputmode="decimal" autocomplete="off" value=""/>
          </div>
          <div>
            <label for="comissao">Comiss√£o (%)</label>
            <input id="comissao" type="text" inputmode="decimal" autocomplete="off" value="0"/>
          </div>
          <div>
            <label for="desconto">Desconto (%)</label>
            <input id="desconto" type="text" inputmode="decimal" autocomplete="off" value=""/>
          </div>
        </div>

        <div class="row-actions">
          <div class="switch">
            <input id="preservar" type="checkbox"/>
            <label for="preservar">Preservar margem ap√≥s desconto</label>
          </div>
          <button id="calc" type="button" class="btn-primary">Calcular</button>
          <button id="clear" type="button" class="btn-secondary">Limpar</button>
        </div>
      </div>
    </div>

    <!-- IMPACTO DO DESCONTO (sempre vis√≠vel abaixo do bloco inicial) -->
    <div class="panel impact">
      <div class="panel-h">Impacto do Desconto</div>
      <div class="panel-b">
        <div class="box">
          <div class="lbl">PRE√áO CALCULADO (sem desconto)</div>
          <div class="valor mono" id="preco-sem">R$ 0,00</div>
          <div class="subtxt">Pre√ßo antes do desconto.</div>
        </div>

        <div class="box">
          <div class="lbl">PRE√áO FINAL (com desconto)</div>
          <div class="valor mono green" id="preco-com">R$ 0,00</div>
          <div class="subtxt">Desconto aplicado ao pre√ßo calculado.</div>
        </div>

        <div class="box">
          <div class="lbl">Lucro (sobre venda)</div>
          <div class="subtxt">Sem desconto: <span class="mono" id="lucro-sv-sem">R$ 0,00</span></div>
          <div class="subtxt">Com desconto: <span class="mono" id="lucro-sv-com">R$ 0,00</span></div>
        </div>

        <div class="box">
          <div class="lbl">Lucro Real (residual)</div>
          <div class="subtxt">Sem desconto: <span class="mono" id="lucro-real-sem">R$ 0,00</span></div>
          <div class="subtxt">Com desconto: <span class="mono" id="lucro-real-com">R$ 0,00</span></div>
          <div class="subtxt">Redu√ß√£o do lucro: <span class="mono neg" id="lucro-reducao">R$ 0,00</span></div>
        </div>
      </div>
    </div>

    <footer>
      <strong>Desenvolvida por Eduardo Pires</strong> ‚Äî Analista de Dados<br/>
      Todos os direitos reservados √† <strong>E-Tech Sistemas</strong> ¬∑ üìû (75) 99955-3626<br/>
      <span style="font-size:11px;">C√≥pia, reprodu√ß√£o ou redistribui√ß√£o n√£o autorizada √© expressamente proibida.</span>
    </footer>
  </div>
</body>
</html>
