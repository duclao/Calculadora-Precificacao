<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Pre√ßo Certo ‚Äî Calculadora (Offline)</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root {
    --bg:#0b1220; --bg2:#0f172a; --card:#0c1426; --muted:#94a3b8; --text:#e5e7eb;
    --border:#1f2a3a; --brand1:#6366f1; --brand2:#8b5cf6; --ok:#22c55e; --danger:#ef4444;
    --radius:16px; --shadow:0 12px 28px rgba(0,0,0,.35);
  }
  html,body { margin:0; background:linear-gradient(160deg,var(--bg2),#0a0f1d); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial; }
  .wrap { max-width:980px; margin:0 auto; padding:18px 14px 48px; }
  .title { font-weight:900; font-size:28px; margin:2px 0 6px; text-align:center; }
  .sub { text-align:center; color:var(--muted); margin-bottom:10px; }
  .hero { background:linear-gradient(135deg,#3b82f6,var(--brand2)); border-radius:18px; padding:14px; text-align:center; box-shadow:var(--shadow); }
  .hero .label { font-size:12px; opacity:.9 }
  .hero .price { font-size:34px; font-weight:900; margin:6px 0 0; }
  .panel { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); margin-top:14px; }
  .panel-h { padding:12px 14px; font-weight:800; font-size:18px; background:#0c1a31; border-bottom:1px solid var(--border); }
  .panel-b { padding:12px 14px; }
  .grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
  @media (max-width:780px) { .grid { grid-template-columns:repeat(2,1fr); } }
  @media (max-width:520px) { .grid { grid-template-columns:1fr; } }
  label { font-size:13px; color:#cbd5e1; }
  input[type="text"] { width:100%; padding:11px 12px; border-radius:12px; border:1px solid #2a3953; background:var(--bg2); color:var(--text); font-size:16px; outline:none; }
  .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:10px; }
  button { padding:12px 16px; border:none; border-radius:12px; font-weight:800; color:white; cursor:pointer; }
  .btn { background:linear-gradient(135deg,var(--brand1),var(--brand2)); }
  .btn2 { background:#0b1220; border:1px solid #2a3953; }
  .metric { background:#0c192e; border:1px solid #1b2a42; border-radius:14px; padding:12px; margin-top:10px; }
  .metric .h { font-weight:800; margin-bottom:4px; }
  .k { font-size:22px; font-weight:900; }
  .k.ok { color:var(--ok); } .k.bad { color:var(--danger); }
  canvas { width:100% !important; height:360px !important; }
  /* GATE */
  .gate { position:fixed; inset:0; background:rgba(6,12,24,.9); display:flex; align-items:center; justify-content:center; z-index:9999; }
  .gate-card { width:min(92vw,520px); background:var(--card); border:1px solid var(--border); border-radius:18px; padding:18px; box-shadow:var(--shadow); }
  .gate-title { font-weight:900; font-size:22px; margin:0 0 6px; }
  .gate-sub { color:var(--muted); margin:0 0 12px; font-size:13px; }
  .gate-row { display:flex; gap:10px; align-items:center; }
  .code { flex:1; text-transform:uppercase; text-align:center; letter-spacing:3px; font-weight:900; font-size:20px; }
  .err { color:var(--danger); font-weight:700; font-size:13px; margin-top:6px; display:none; }
  .hide { display:none !important; }
  .foot { text-align:center; margin-top:14px; color:#9aa6bd; font-size:12px; }
</style>
</head>
<body>
  <!-- Gate -->
  <div id="gate" class="gate">
    <div class="gate-card">
      <div class="gate-title">üîê Acesso restrito (offline)</div>
      <div class="gate-sub">Digite seu c√≥digo de 4 caracteres. Validade local: 7 dias neste dispositivo.</div>
      <div class="gate-row">
        <input id="gate-code" class="code" maxlength="4" placeholder="AB12" autocomplete="one-time-code"/>
        <button id="gate-ok" class="btn">Desbloquear</button>
      </div>
      <div id="gate-err" class="err">C√≥digo inv√°lido.</div>
      <div class="foot">*Sem servidor: o mesmo c√≥digo pode funcionar em outros dispositivos.</div>
    </div>
  </div>

  <!-- App -->
  <div id="app" class="wrap hide">
    <div class="title">Pre√ßo Certo</div>
    <div class="sub">Calculadora de Precifica√ß√£o Inteligente</div>

    <div class="hero">
      <div class="label">Pre√ßo sugerido</div>
      <div id="p-sug" class="price">R$ 0,00</div>
    </div>

    <div class="panel">
      <div class="panel-h">Par√¢metros</div>
      <div class="panel-b">
        <div class="grid">
          <div><label for="custo">Custo (R$)</label><input id="custo" type="text" inputmode="decimal"></div>
          <div><label for="despesas">Despesas (%)</label><input id="despesas" type="text" inputmode="decimal"></div>
          <div><label for="impostos">Impostos (%)</label><input id="impostos" type="text" inputmode="decimal"></div>
          <div><label for="comissao">Comiss√£o (%)</label><input id="comissao" type="text" inputmode="decimal"></div>
          <div><label for="lucro">Lucro (%)</label><input id="lucro" type="text" inputmode="decimal"></div>
          <div><label for="desconto">Desconto (%)</label><input id="desconto" type="text" inputmode="decimal"></div>
        </div>
        <div class="row">
          <button id="calc" class="btn">Calcular</button>
          <button id="clear" class="btn2">Limpar</button>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-h">Fator Markup</div>
      <div class="panel-b">
        <div class="hero" style="padding:8px 14px; margin-top:0;">
          <div class="label">Fator aplicado</div>
          <div id="fator" class="price">√ó 1,000</div>
          <div class="sub">F√≥rmula: 100 √∑ (100 ‚àí (Despesas + Impostos + Comiss√£o + Lucro))</div>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-h">Impacto do Desconto</div>
      <div class="panel-b">
        <div class="metric">
          <div class="h">PRE√áO CALCULADO (SEM DESCONTO)</div>
          <div id="preco-sem" class="k">R$ 0,00</div>
          <div class="sub">Pre√ßo antes do desconto.</div>
        </div>
        <div class="metric">
          <div class="h">PRE√áO FINAL (COM DESCONTO)</div>
          <div id="preco-com" class="k ok">R$ 0,00</div>
          <div class="sub">Desconto aplicado ao pre√ßo calculado.</div>
        </div>
        <div class="metric">
          <div class="h">LUCRO (SOBRE VENDA)</div>
          <div>Sem desconto: <span id="lucro-sv-sem" class="k">R$ 0,00</span></div>
          <div>Com desconto: <span id="lucro-sv-com" class="k">R$ 0,00</span></div>
        </div>
        <div class="metric">
          <div class="h">LUCRO REAL (RESIDUAL)</div>
          <div>Sem desconto: <span id="lucro-res-sem" class="k">R$ 0,00</span></div>
          <div>Com desconto: <span id="lucro-res-com" class="k">R$ 0,00</span></div>
          <div>Redu√ß√£o do lucro: <span id="lucro-red" class="k bad">R$ 0,00</span></div>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-h">Gr√°fico de Composi√ß√£o do Pre√ßo</div>
      <div class="panel-b">
        <canvas id="graf"></canvas>
      </div>
    </div>
  </div>

<script>
// ===== Configs (OFFLINE) =====
const VALID_FOR_MS = 7*24*60*60*1000;
const LS_KEY = "precoCertoLicense";
const CODE_LIST = ["246R", "2HG3", "2KR2", "337C", "3D8S", "3Y67", "46JW", "46LC", "4TPX", "563C", "56G2", "5JGE", "5LTM", "5MZG", "5XR9", "67MD", "6JK6", "6TAA", "77R3", "7URV", "8CNR", "8D7J", "8PZ4", "8XNM", "9T4J", "9XK5", "AEHK", "AYMF", "B64L", "BJXW", "C4ED", "CBH2", "CG9R", "CH9P", "D82V", "D9A9", "DD8S", "DZ6T", "E2LE", "E78D", "FLBK", "FT3H", "H5EX", "HV63", "HZBB", "J5M2", "JCSW", "JCXG", "JKAZ", "JXX4", "KX39", "L7GQ", "L7HZ", "L9PB", "LAZ5", "LUSZ", "LVT4", "M9K9", "MEFG", "MEK5", "MP8L", "NBWV", "NKWJ", "NME8", "NR8T", "QH4R", "QL9W", "QM7L", "RAZE", "RCWW", "RDFX", "RXPM", "S9MZ", "SLJ2", "SXT4", "SYT6", "T3SQ", "TETJ", "TEY5", "TFPC", "U6Z6", "V2BD", "V6XQ", "VPLW", "VPY3", "VZH7", "VZJ8", "W6YR", "WEGL", "WGFG", "X42S", "XAXZ", "XHWB", "XLS6", "Y3FL", "YCEA", "YGT7", "YK83", "Z2RX", "ZZ36"]; // <- embedded codes

// ===== Utils =====
const $ = id => document.getElementById(id);
const toNum = s => { s = String(s??'').replace(/\s+/g,'').replace(/[^0-9,\.\-]/g,''); const p=s.split(/[.,]/); if(p.length>1){const d=p.pop(); s=p.join('')+'.'+d;} else { s=s.replace(',', '.'); } const n=parseFloat(s); return isNaN(n)?0:n; };
const fmt = v => Number(v||0).toLocaleString('pt-BR',{style:'currency', currency:'BRL'});

// ===== Gate (offline) =====
const load = () => { try{ return JSON.parse(localStorage.getItem(LS_KEY)||'null'); }catch(_){ return null; } };
const save = o => localStorage.setItem(LS_KEY, JSON.stringify(o));
const clearLS = () => localStorage.removeItem(LS_KEY);
const isValid = rec => rec && rec.code && rec.activatedAt && (Date.now()-rec.activatedAt)<=VALID_FOR_MS;
const showApp = () => { document.getElementById('gate').classList.add('hide'); document.getElementById('app').classList.remove('hide'); };
const showGate = () => { document.getElementById('gate').classList.remove('hide'); document.getElementById('app').classList.add('hide'); };

function checkCodeLocal(code){
  return CODE_LIST.includes(code.toUpperCase());
}

document.addEventListener('DOMContentLoaded',()=>{
  const rec = load();
  if(rec && isValid(rec)) showApp(); else showGate();

  document.getElementById('gate-ok').addEventListener('click', ()=>{
    const code = (document.getElementById('gate-code').value||'').trim().toUpperCase();
    const err = document.getElementById('gate-err'); err.style.display='none';
    if(code.length!==4){ err.textContent='Informe 4 caracteres.'; err.style.display='block'; return; }
    if(!checkCodeLocal(code)){ err.textContent='C√≥digo inv√°lido.'; err.style.display='block'; return; }
    // Aprova localmente e salva
    save({ code, activatedAt: Date.now() });
    showApp();
  });

  // Guard: expira e bloqueia tudo
  setInterval(()=>{ const r=load(); if(!isValid(r)){ clearLS(); showGate(); } }, 60000);
});

// ===== C√°lculo =====
let chart;
function calc(){
  const custo = toNum(document.getElementById('custo').value);
  const d = toNum(document.getElementById('despesas').value);
  const i = toNum(document.getElementById('impostos').value);
  const c = toNum(document.getElementById('comissao').value);
  const l = toNum(document.getElementById('lucro').value);
  const ds = toNum(document.getElementById('desconto').value);
  const soma = d+i+c+l;

  if(soma >= 100){ alert('A soma de percentuais (Despesas+Impostos+Comiss√£o+Lucro) n√£o pode ser ‚â• 100%.'); return; }

  const fator = 100/(100 - soma || 1);
  document.getElementById('fator').textContent = '√ó ' + fator.toFixed(3);

  const preco = custo * fator;
  const precoDesc = preco * (1 - ds/100);

  document.getElementById('p-sug').textContent = fmt(preco);
  document.getElementById('preco-sem').textContent = fmt(preco);
  document.getElementById('preco-com').textContent = fmt(precoDesc);

  const lucroSVsem = preco - custo;
  const lucroSVcom = precoDesc - custo;
  document.getElementById('lucro-sv-sem').textContent = fmt(lucroSVsem);
  document.getElementById('lucro-sv-com').textContent = fmt(lucroSVcom);

  const lucroResidualSem = preco * (l/100);
  const lucroResidualCom = precoDesc * (l/100);
  document.getElementById('lucro-res-sem').textContent = fmt(lucroResidualSem);
  document.getElementById('lucro-res-com').textContent = fmt(lucroResidualCom);
  document.getElementById('lucro-red').textContent = fmt(lucroResidualSem - lucroResidualCom);

  const labels = ['Custo','Despesas','Impostos','Comiss√£o','Lucro'];
  const values = [ (100 - soma), d, i, c, l ];
  const ctx = document.getElementById('graf').getContext('2d');
  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type:'bar',
    data:{ labels:['Pre√ßo'], datasets:[
      { label:labels[0], data:[values[0]] },
      { label:labels[1], data:[values[1]] },
      { label:labels[2], data:[values[2]] },
      { label:labels[3], data:[values[3]] },
      { label:labels[4], data:[values[4]] }
    ]},
    options:{
      responsive:true,
      plugins:{ legend:{ position:'top' } },
      scales:{ x:{ stacked:true }, y:{ stacked:true, max:100, ticks:{ callback:v=>v+'%' } } }
    }
  });
}

function clearAll(){
  ['custo','despesas','impostos','comissao','lucro','desconto'].forEach(id=>document.getElementById(id).value='');
  calc();
}

document.addEventListener('DOMContentLoaded',()=>{
  ['custo','despesas','impostos','comissao','lucro','desconto'].forEach(id=>document.getElementById(id).addEventListener('input',calc));
  document.getElementById('calc').addEventListener('click',calc);
  document.getElementById('clear').addEventListener('click',clearAll);
  calc();
});
</script>
</body>
</html>
